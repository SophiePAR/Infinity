<div class="container">
  <div class="row">
    <div class="container col-7 mt-3"> 
    <h2 class="text-primary text-center mt-2 w-100 border-bottom-5 "><%= @user.first_name %> <%= @user.last_name %>, bienvenue sur votre profil </h2>
    <%# <div class="container mt-3">  %>
        <p class='mt-3'>Suivez en un coup d'oeil les prestations gràce aux notifications sur chacune de vos sépultures. Accédez au suivi des prestations ou recherchez des missions proches de chez vous. N'hésitez pas à ajouter toutes les tombes de vos proches. </p>
        <h2 class="text-primary mt-3 mb-3">Mes sépultures</h2>
        <div class="cards w-70">
          <% @tombstones.each do |tombstone| %>

            <% if tombstone.photo.attached? %>
              <%# -----definition variable image-----  %>
              <% image = cl_image_path tombstone.photo.key, height: 200, width: 300, crop: :fill %>
            <% else %>
              <% image = asset_url('tombstone.png') %>
            <% end %>
            <%= link_to tombstone_path(tombstone) do %>

              <div class="card-category", style="background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0)), url('<%= image %>'); background-size: cover; background-position: center">
                <%# -----badge notification-----  %>
                <% if tombstone.orders.where(:progress => [:pending, :accepted, :validated, :finished]).count == 0 %>
                  <div class="batg", style="visibility:hiden">
                  </div>                
                <% else %>
                  <div class="batg">
                    <% if tombstone.orders.where(:progress => :accepted).count == 0 %>
                      <p data-controller="tooltip" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title=" Vous avez <%= tombstone.orders.where(:progress => [:pending, :accepted, :validated]).count  %> notifications:" class="badge"><%= tombstone.orders.where(:progress => [:pending, :accepted, :validated]).count %></p>
                    <% elsif tombstone.orders.where(:progress => :accepted).count != 0 %>
                      <p data-controller="tooltip" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title=" Vous avez <%= tombstone.orders.where(:progress => [:pending, :accepted, :validated]).count  %> notifications:" class="badge-orange"><%= tombstone.orders.where(:progress => [:pending, :accepted, :validated]).count %></p>
                    <% end %>
                  </div>
                <% end %>
              </div>
             <h4 class="name-user m-2"><%= tombstone.first_name %> <%= tombstone.last_name %></h4>
            <% end %>
          <% end %>
          <%= link_to "", new_tombstone_path, class: "fa-solid fa-circle-plus text-center fa-xl" %>
        </div>

        </div>
 
    <div class="container col-4">
            <div class="container-btn">
          <%= link_to "Rechercher des missions", provider_orders_path , class: "btn btn-primary mt-4 w-100" %>
          
          <%= link_to "Voir mes missions", my_missions_path , class: "btn btn-info mt-3 w-100" %>
        </div>
      <div class="geo-map-users w-100" >
        <div style="width: 100%; height: 600px;"
          data-controller="map"
          data-map-markers-value="<%= @markers.to_json %>"
          data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
        </div>
      </div>
    </div>
  </div>
</div>
