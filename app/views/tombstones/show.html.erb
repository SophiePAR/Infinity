<div class="tomb-info">
    <h1 class='text-center text-primary'>Bienvenue sur la sépulture de <%= @tombstone.first_name %></h1>
      <p class='back-btn'><%= link_to "Retour au profil", user_path(current_user), class: "btn btn-flat mb-2" %></p>
</div>
<div class="container mt-5">
  <div class="photo">
    <% if @tombstone.photo.key? %>
      <%= cl_image_tag @tombstone.photo.key, height: 300, width: 200, crop: :fill %>
    <% else %>
      <%= image_tag asset_path('tombstone.png'), height: 300, width: 400%>
    <% end %>
    <p class="mt-3"><%= link_to "Editer la sépulture", edit_tombstone_path(@tombstone), class: "btn btn-danger mb-2" %></p>
  </div>
  <div class="info">
    <h4>Informations</h4>
      <p><strong>Prénom : </strong><%= @tombstone.first_name %></p>
      <p><strong>Nom : </strong><%= @tombstone.last_name %></p>
      <p><%= @tombstone.birth_date.strftime("%d %B %Y") %></p>
      <p><%= @tombstone.death_date.strftime("%d %B %Y") %></p>
  </div>
  <div class="text-center">
    <div class="mb-3">
      <%= simple_form_for [@tombstone, @order] do |f| %>
        <%= f.input :user_tombstone_id, input_html:{value: current_user.find_user_tombstone(@tombstone).id}, as: :hidden  %>
        <%= f.submit "Ajouter une nouvelle prestation", class: "btn btn-primary px-5 py-3" %>
      <% end %>
    </div>
      <div class="meteo">
        <h3>Météo sur place</h3>
          <p><%= Date.today.strftime("%d %B %Y") %></p>
            <img src="http://openweathermap.org/img/wn/<%=  @data["weather"].first["icon"] %>@2x.png" alt="">
            <div class="meteo-card">
              <p><%= @data["weather"].first["description"] %></p>
              <p>Température : <%= @data["main"]["temp"].round(1) %> °c</p>
              <p>Ressenti : <%= @data["main"]["feels_like"].round(1) %> °c</p>
              <p>Ville : <%= @data["name"] %></p>
      </div>
    </div>
  </div>
  <div class="fil-actualité">
    <% @tombstone.orders.each do |order| %>
      <% if order.accepted? %>
        <%= simple_form_for order do |f| %>
          <%= f.input :progress, value: 'accepted', as: :hidden %>
          <%= f.button :submit, "Valider le prestataire", class: "btn btn-primary" %>
        <% end %>
        <%= link_to "Refuse le prestation", order_path(order), class: "btn btn-danger"  %>
      <% end %>
    <% end %>
    <div class="message">
      <%= simple_form_for [@tombstone, @message],
        html: {class: "d-flex"} do |f|
      %>
        <%= f.input :content,
          label: false,
          # placeholder: "Message ##{@chatroom.name}",
          wrapper_html: {class: "flex-grow-1"}
        %>
        <%= f.submit "Send", class: "btn btn-primary mb-3" %>
      <% end %>
    </div>
  </div>
  <div class="membre-de-la-famille">
    <div class="shared-with bg-primary p-2">
      <h4 class='text-white text-center'>Cette tombe est partagé avec</h4>
        <ul>
          <% @tombstone.user_tombstones.each do |user_tombstone| %>
            <li class='text-white text-center'>
              <%= user_tombstone.user.first_name %> <%= user_tombstone.user.last_name %>
            </li>
          <% end %>
        </ul>
    </div>
  </div>
  <div class="prestation-en-cours">
    <div class="order-statut m-1">
      <h3>Prestations en cours:</h3>
        <% @tombstone.orders.each do |order| %>
          <h5>Commande du : <%= link_to order.created_at.strftime("%d %B %Y"), order_path(order) %></h5>
            <% @user = UserTombstone.find(order.user_tombstone_id).user %>
              <p>Faite par <strong><%= @user.first_name %> <%= @user.last_name  %></strong></p>
              <p>Statut: <%= order.progress %></p>
              <p>note : <%= order.rating %> <%= order.review %></p>
        <% end %>
    </div>
  </div>
</div>
